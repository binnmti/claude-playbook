---
description: 新しい実装プランを作成する
---

# 新規プラン作成

ユーザーの要望を元に、構造化された実装プランを作成します。

## 使い方

```
/plan-new
```

## 核心原則

1. **検証可能性**: 各タスクに明確な完了条件と検証方法を定義
2. **探索→計画→実装**: 理解してから計画する
3. **インタビュー駆動**: 曖昧さは質問で解消

## 実行手順

### Step 1: 要望の収集（インタビューパターン）

**目的**: 曖昧さを排除し、検証可能な要件を定義する

1. 「何を実装したいですか？」と聞く
2. 以下の観点で深掘り質問：
   - **技術的詳細**: どのような実装方式か？既存パターンに従うか？
   - **エッジケース**: 異常系の扱いは？
   - **UI/UX**: ユーザーからどう見えるべきか？
   - **検証方法**: 成功をどう確認するか？（テスト、スクリーンショット等）
3. 「他にやりたいことはありますか？」
4. 全部揃うまで繰り返し

**要件リスト表示:**

```markdown
## 現在の要件リスト

| # | 要件 | 検証方法 |
|---|------|---------|
| 1 | {要件} | {テスト/手動確認/スクリーンショット} |

他にやりたいことはありますか？
```

### Step 2: コードベース探索

**目的**: 既存パターンを理解し、適切な実装方針を決める

1. **サブエージェント（Explore）で調査**:
   - 関連する既存コードの構造
   - 類似機能の実装パターン
   - テストの書き方
2. **調査結果を要約**:
   - 参考にすべきファイル（`@src/xxx.cs` 形式で明示）
   - 既存パターンとの整合性
   - 潜在的なリスク

```markdown
## 調査結果

### 参考ファイル
- @src/Infrastructure/Services/XxxService.cs - 類似パターン
- @tests/XxxTests.cs - テストの書き方

### 実装方針
{既存パターンに従った実装方針}
```

### Step 2.5: 方向性の確認

**目的**: 初手の失敗を防ぎ、手戻りを最小化する

調査結果を元に、ユーザーに方向性を確認する:

```markdown
## 方向性の確認

### 実装方針
{調査結果から導いた方針}

### 懸念点・リスク
- {技術的リスクがあれば}
- {代替案があれば}

この方向性で進めてよいですか？
```

**承認を得てから**次のステップへ進む。

### Step 3: プランファイルの作成

ユーザーのゴーサインが出たら：

1. ブランチ名を決定（`feature/{YYYY-MM}-{説明}` 形式）
2. 以下を作成：

```
doc/plans/{branch-name}/
├── README.md
├── task-01-xxx.md
└── task-02-xxx.md
```

### Step 4: README.md

```markdown
# 実装プラン: {プラン名}

## 概要

{プランの目的}

## ブランチ

```
{branch-name}
```

## タスク一覧

| # | ファイル | 内容 | 依存 |
|---|---------|------|------|
| 01 | task-01-xxx.md | {概要} | なし |
| 02 | task-02-xxx.md | {概要} | 01 |

## コミット規約

```
<type>: <description>

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```

## 進捗

- [ ] ブランチ作成
- [ ] task-01 完了
- [ ] task-02 完了
- [ ] 全テスト通過
- [ ] mainへマージ
```

### Step 5: タスクファイル

**重要**: 各タスクに具体的な検証基準を含める（これが最も効果的なベストプラクティス）

```markdown
# タスク{番号}: {タスク名}

## 目的

{達成すること - 検証可能な形で記述}

## 背景

{なぜ必要か}

## 参考ファイル

<!-- @記法で参照し、既存パターンに従う -->
- @src/xxx.cs - {このパターンに従う}
- @tests/xxxTests.cs - {テストの書き方}

## 対象ファイル

- `src/xxx.cs` - {変更内容}

## 実装内容

- [ ] {実装項目1}
- [ ] {実装項目2}

## 検証基準（必須）

<!-- 成功を判断するための具体的な基準 -->

### 自動検証
- [ ] `dotnet build` 成功
- [ ] `dotnet test` 成功
- [ ] {追加のテストケース: 入力→期待出力}

### 手動検証（必要な場合）
- [ ] {UI確認項目}
- [ ] {動作確認手順}

## 完了条件

- {検証基準をすべて満たす}
- 既存テストが通る
- 新機能のテストが追加されている

---

## 実行結果

<!-- /plan-run 実行時に自動追記 -->
```

### Step 6: ブランチ作成

```bash
git checkout -b {branch-name}
```

### Step 7: ダッシュボードHTML更新

`doc/plans/index.html` を編集し、新しいプランを「進行中のプラン」セクションに追加：

1. 進行中プランの数（バッジ）を更新
2. 新しいプランカードを追加（テンプレート）：
   ```html
   <div class="plan-card">
     <div class="plan-header">
       <span class="plan-name">{プラン名}</span>
       <span class="plan-status status-pending">未着手</span>
     </div>
     <p class="plan-description">{概要}</p>
     <div class="plan-meta">
       <div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div>
       <span class="task-count">0 / {タスク数} タスク</span>
     </div>
     <a class="plan-link" href="{folder-name}/README.md">詳細を見る →</a>
   </div>
   ```
3. 最終更新日を更新

## 出力形式

```
## プラン作成完了

- プラン名: {プラン名}
- ブランチ: {branch-name}
- タスク数: N件
- 場所: doc/plans/{branch-name}/

次のステップ: `/plan-run doc/plans/{branch-name}`
```

## 命名規約

- **ブランチ名**: `feature/{YYYY-MM}-{説明}` または `fix/{issue番号}-{説明}`
- **タスクファイル**: `task-{番号2桁}-{kebab-case}.md`

## プラン分割の判断基準

以下の場合はプランを分割：
- タスクが5個以上になる場合
- 異なる機能領域にまたがる場合
- 依存関係が複雑になる場合

## 注意事項

- タスクは小さく分割（1タスク = 1コミット程度）
- **検証基準を必ず含める**（テスト、手動確認、期待出力）
- 探索は宣言してからサブエージェントで実行
- 全要望を聞いてからプランファイルを作成
- @記法で参照ファイルを明示し、既存パターンに従う
