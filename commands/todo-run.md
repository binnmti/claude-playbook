# タスク実行

plan.md の内容を愚直に実行し、done.md に完了報告を記録します。

## 使い方

```
/todo-run <plan.mdのパス>
```

例: `/todo-run doc/todos/tasks/task-01-認証/plan.md`


## 核心原則

1. **plan.md を愚直に実行**
2. **検証駆動**: 検証基準で完了判断
3. **コンテキスト分離**: サブエージェントで実行
4. **早期軌道修正**: 2回失敗したら方針見直し

## 実行手順

### Step 1: 開始

1. plan.md を読む
2. todo.md で該当タスクを **Doing** に移動

### Step 2: タスク実行（サブエージェント）

`Task` ツール（general-purpose）で実行:

```
以下のタスクを実行してください。

## plan.md の内容
{plan.mdの全内容}

## 開発原則
CLAUDE.mdに従う。参考ファイル（@記法）のパターンに従う。

## 完了条件
- plan.mdの検証基準をすべて満たす
- ビルド成功
- テスト成功

コミットは後でまとめて行います。

## 報告形式
- ステータス: completed / blocked / failed
- 変更ファイル: リスト
- 検証結果: 通過/失敗
```

### Step 3: クイックレビュー（サブエージェント）

`Task` ツール（general-purpose）で実行:

```
.claude/commands/review.md の手順でクイックレビューを実行。
指摘があれば修正。コミットはしない。
```

### Step 4: 軌道修正判断

- **成功**: Step 5 へ
- **1回目失敗**: アプローチを変えて再試行
- **2回目失敗**: 停止してユーザーに報告

### Step 5: ファイナルレビューとコミット

`Task` ツール（general-purpose）で実行:

```
.claude/commands/review.md の手順でファイナルレビュー実行。
指摘修正後、全変更をコミット。
```

### Step 6: 完了処理

**1. todo.md を更新:**
```markdown
## Done
- [x] 認証機能を追加する (2024-01-15)
```

**2. done.md を作成:**

`tasks/task-xx/done.md` に簡潔に記録（人間が読む用）:

```markdown
# 完了: 認証機能

## 次にやること
- `localhost:3000/login` で動作確認
- test@example.com / password でログイン

## やったこと
- AuthService追加
- JWT発行処理
- ログインAPI

```

**ポイント**: 書きすぎない。次に何をすべきかが分かればOK。

**3. ユーザーに報告:**
```
## タスク完了: 認証機能

done.md: tasks/task-01-認証/done.md
コミット: {hash}

次: 動作確認してください
```

## 出力形式

**開始時:**
```
## タスク開始: {タスク名}
```

**完了時:**
```
## タスク完了: {タスク名}
done.md: {パス}
```

## 注意事項

- plan.md を愚直に実行
- 検証基準を満たすまで完了としない
- done.md は簡潔に（ぺら1枚）
- 複数タスク一括実行は `/todo-batch` を使用
