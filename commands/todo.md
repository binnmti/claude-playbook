# ToDoリスト管理

ユーザーの要望をToDoリストに整理し、タスクとして管理します。

## 使い方

```
/todo
```

## 核心原則

1. **ToDoリストがメイン**: ユーザーはここだけ見ればOK
2. **基本はシンプル、必要に応じて階層で詳細化**: やりたいことを項目として書き、詳細が必要なら階層で追加
3. **両方が編集**: ユーザーもClaudeもToDoを追加できる
4. **探索→計画**: 理解してからToDoに落とす
5. **手作業の事前検討**: 自律実行を妨げる手作業を最小化

## ファイル構造

```
doc/todos/
├── todo.md           # メイン（両方が編集）
├── done.md           # 完了報告（Claude、ユーザーが確認用に読む）
├── tasks/            # 未完了タスク
│   └── task-xx/
│       ├── plan.md   # Claude用詳細（ユーザーはほぼ見ない）
└── done/             # 完了タスク（/todo-run完了時に移動）
    └── task-xx/
        ├── plan.md
```

## 参照フロー（ユーザー視点）

```
todo.md → (完了後) → done.md → (詳細必要なら) → plan.md
```

## タスクの書き方

**基本**: やりたいことをシンプルに1行で書く
**詳細が必要な場合**: 階層（インデント）を使って説明を追加

```markdown
## ToDo
- [ ] 認証機能を追加する              ← シンプルに1行でもOK
- [ ] ログ出力を改善する
  - 現状のログレベルを見直す          ← 詳細が必要なら階層で追加
  - エラーログにスタックトレースを含める
```

**関連するものは1タスクにまとめ**、**関連しないものは別タスクに分ける**。

## todo.md の構造

```markdown
# やること

## ToDo
- [ ] {未着手タスク}

## Doing
- [ ] {進行中タスク}

## Done
- [x] {完了タスク} (YYYY-MM-DD)
```

## 実行手順

### Step 1: 要望の収集

1. ユーザーの話を聞く
2. 以下の観点で深掘り質問：
   - **技術的詳細**: どのような実装方式か？
   - **エッジケース**: 異常系の扱いは？
   - **検証方法**: 成功をどう確認するか？
3. 「他にやりたいことはありますか？」と確認
4. 全部揃うまで繰り返し

### Step 2: コードベース探索（サブエージェント）

**コンテキスト節約のため、`Task` ツール（Explore）で調査**:

```
以下の要件に関連するコードを調査してください。

## 要件
{ユーザーの要望}

## 調査観点
- 関連する既存コードの構造
- 類似機能の実装パターン
- テストの書き方

## 出力形式
- 参考ファイル: @記法でリスト
- 既存パターン: 概要
- 潜在的なリスク: あれば
```

### Step 2.5: 方向性の確認

**目的**: 初手の失敗と手作業による停止を防ぐ

調査結果を元に、ユーザーに方向性を確認する:

```markdown
## 方向性の確認

### 実装方針
{調査結果から導いた方針}

### 手作業の検討
- 自動化可能: {リスト}
- 手作業が必要: {ある場合は理由と発生タイミング}

### 懸念点・リスク
- {技術的リスクがあれば}

この方向性で進めてよいですか？
```

**承認を得てから**次のステップへ進む。

### Step 3: ToDoリストの整理

**関連するものはまとめる:**
- 似た機能、同じ領域 → 1つのタスク

**関連しないものは分ける:**
- 異なる機能 → 別タスク

### Step 4: todo.md に追加

基本はシンプルに。詳細が必要な項目は階層で追加。

### Step 5: タスク詳細（plan.md）を作成

**各タスクに対して `tasks/task-xx/plan.md` を作成**:

```markdown
# タスク: 認証機能

## 参考ファイル
- @src/xxx.cs - 既存パターン
- @tests/xxxTests.cs - テストの書き方

## 実装内容
- [ ] AuthService追加
- [ ] ログインAPI

## 検証基準
- [ ] ビルド成功
- [ ] テスト成功

## 手作業（あれば）
- なし
```

## 役割分担

| 操作 | 誰が |
|------|------|
| ToDoに追加 | 両方 |
| ToDo → Doing | Claude（/todo-run 実行時） |
| Doing → Done | Claude（タスク完了時） |
| done.md記載 | Claude（/todo-run 完了時） |
| plan.md作成 | Claude |

## 出力形式

```
## ToDoリスト更新完了

追加したタスク:
- {タスク1}
- {タスク2}

次のステップ: `/todo-run` でタスクを実行
```

## 注意事項

- todo.md がメイン
- 探索は宣言してからサブエージェントで実行
- 全要望を聞いてからToDoリストを作成
- @記法で参照ファイルを明示
- **手作業が発生する場合は必ず事前に伝える**
