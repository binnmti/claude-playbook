---
name: todo
description: ToDoリストの管理。タスクの追加・整理・更新が話題になったとき、またはユーザーがやりたいことを話しているときに使う。
---

# ToDoリスト管理

ユーザーの要望をToDoリストに整理し、タスクとして管理します。

## 使い方

`/todo` で明示的に呼び出すか、会話中にToDoの話題が出たら自動で発動します。

## 核心原則

1. **todo.mdがメイン**: ユーザーはここだけ見ればOK
2. **シンプルに書き、必要に応じて階層で詳細化**: 固定構造にしない
3. **両方が編集**: ユーザーもClaudeもToDoを追加できる
4. **todo.mdは即時、plan.mdは会話が熟してから**: todo.mdは話題が出た時点で更新し、plan.mdはユーザーが合図してから作成する

## ファイル構造

```
doc/todos/
├── todo.md           # メイン（両方が編集）
├── tasks/            # 未完了タスク
│   └── task-xx/
│       └── plan.md   # Claude用詳細（ユーザーはほぼ見ない）
└── done/             # 完了タスク（/todo-run完了時に移動）
    └── task-xx/
        └── plan.md
```

参照フロー: `todo.md` → (詳細必要なら) → `plan.md`

## タスクの書き方

**基本**: やりたいことをシンプルに1行で書く
**階層の深さはタスクの複雑さに合わせる**。固定構造にしない。

```markdown
## ToDo
- [ ] Face ID機能復活（保留）          ← シンプルなら1行だけ
  - Azure Face API Limited Access申請後

- [ ] ログ出力を改善する               ← 少し詳細があれば数行
  - 現状のログレベルを見直す
  - エラーログにスタックトレースを含める

- [ ] DBスキーマ変更                   ← 深いタスクは要約 + plan.mdリンク
  - API生データとWikiデータをソース別テーブルで管理
  - Actressテーブルは「解決済み」の値を持つ
  - 詳細: [task-14/plan.md](tasks/task-14/plan.md)
```

**関連するものは1タスクにまとめ**、**関連しないものは別タスクに分ける**。

## todo.md の構造

```markdown
# やること

## ToDo
- [ ] {未着手タスク}

## Doing
- [ ] {進行中タスク}

## Done
- [x] {完了タスク} (YYYY-MM-DD)
```

## 会話中の振る舞い

会話中、以下を並行して行う：

### todo.mdの更新（随時）

- ユーザーが「やりたいこと」を話したら、その時点でtodo.mdに追加する
- 全部揃うのを待たない
- 最初はシンプルな1行で追加し、会話が深まるにつれて階層を育てる
- 会話が進んでグルーピングや優先度が変わったら、その都度todo.mdを調整する

### 会話の深掘り（自然に）

話の中で必要に応じて深掘り質問する：
- **ゴール**: このタスクは何が実現できたら完了か？
- **技術的詳細**: どのような実装方式か？
- **エッジケース**: 異常系の扱いは？
- **手作業の有無**: 自律実行を妨げるものはあるか？

特に**ゴールの明確化**が重要。「何ができたら終わりか」が曖昧だと、実行時に方向がズレる。
この深掘りの結果は、後のplan.md作成の材料になる。

### plan.md作成のタイミング

会話が一通り終わり、ユーザーが「作って」「お願い」等と言ったタイミングで：

1. **コードベース探索（サブエージェント）**

**コンテキスト節約のため、`Task` ツール（Explore）で調査**:

```
以下の要件に関連するコードを調査してください。

## 要件
{ユーザーの要望}

## 調査観点
- 関連する既存コードの構造
- 類似機能の実装パターン
- テストの書き方

## 出力形式
- 参考ファイル: @記法でリスト
- 既存パターン: 概要
- 潜在的なリスク: あれば
```

2. **方向性の確認**

**目的**: 初手の失敗と手作業による停止を防ぐ

調査結果を元に、ユーザーに方向性を確認する:

```markdown
## 方向性の確認

### 実装方針
{調査結果から導いた方針}

### 手作業の検討
- 自動化可能: {リスト}
- 手作業が必要: {ある場合は理由と発生タイミング}

### 懸念点・リスク
- {技術的リスクがあれば}

この方向性で進めてよいですか？
```

**承認を得てから**次へ進む。

3. **plan.md作成 + todo.mdの階層更新**

**各タスクに対して `tasks/task-xx/plan.md` を作成**:

```markdown
# タスク: 認証機能

## ゴール
このタスクが完了したとき、何が実現できているか：
- [ ] /api/login にPOSTするとJWTトークンが返る
- [ ] 無効な認証情報で401が返る
- [ ] トークンなしで保護エンドポイントにアクセスすると403が返る

ゴールは検証可能な形で書く。
実行時はこのゴールに向かってステップバイステップで進める。

## 参考ファイル
- @src/xxx.cs - 既存パターン
- @tests/xxxTests.cs - テストの書き方

## 実装ステップ
- [ ] AuthService追加
- [ ] ログインAPI
- [ ] 認証ミドルウェア

## 手作業（あれば）
- なし
```

plan.md作成後、todo.mdの該当タスクにも要約を反映する：
- plan.mdの内容をそのまま転記しない（todo.mdはシンプルに保つ）
- タスクの意図が伝わる最小限の要約を階層に追加
- `詳細: [task-xx/plan.md]` リンクを付ける

## 出力形式（plan.md作成完了時）

```
## ToDoリスト更新完了

追加したタスク:
- {タスク1}
- {タスク2}

次のステップ: `/todo-run` でタスクを実行（会話が長い場合は新しいセッション推奨）
```
